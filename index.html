<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <title>NoPFIC (NoP Fan-fictions' Interactive Chart)</title>

  <!-- Include Angular Material CSS -->
  <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/angular_material/0.10.0/angular-material.min.css">

  <style>
    html, body {
      margin: 0px;
      padding: 0px;
      font-family: sans-serif;
    }

    #network {
      width: 100%;
      height: 90vh;
      border: 0px solid lightgray;
    }

    #about {
      margin-top: 10px;
      text-align: center;
    }

    #popup {
      display: none;
      position: absolute;
      background: #222;
      color: white;
      padding: 10px;
      border-radius: 8px;
      z-index: 10;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }
  </style>
</head>

<body>
  <div id="network"></div>
  <div id="about">Chart by <a href="https://www.reddit.com/user/Heroman3003/" target="_blank">u/Heroman3003</a> and <a href="https://www.reddit.com/user/AlexWaveDiver/" target="_blank">u/AlexWaveDiver</a></div>
  <div id="popup"></div>

  <script src="//unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

  <script>
    fetch('graph_data.json')
      .then(response => response.json())
      .then(data => {

        data.nodes.forEach(node => {
          if (node.NSFW) {
            node.color = {
              background: '#ff69b4',
              border: '#cc3366'
            };
          } else if (node.AU) {
            node.color = {
              background: '#999999',
              border: '#666666'
            };
          }
        });
        const options = {
          nodes: {
            shape: "box",
            font: { color: "white" }
          },
          groups: {
            central: { color: { background: "#444", border: "#222" } },
            primary: { color: { background: "#1f77b4", border: "#17406d" } },
            secondary: { color: { background: "#2ca02c", border: "#1e6823" } },
            default: { color: { background: "#999", border: "#666" } }
          },
          physics: {
            stabilization: true
          }
        };

        const container = document.getElementById("network");
        const network = new vis.Network(container, data, options);

        network.on("click", function (params) {
          const popup = document.getElementById("popup");
          popup.style.display = "none";

          if (params.nodes.length > 0) {
            const nodeId = params.nodes[0];
            const node = data.nodes.find(n => n.id === nodeId);

            if (node && node.url) {
              const pointer = params.pointer.DOM;
              popup.innerHTML = `<div style='text-align: center'>
                <strong>${node.label}</strong><br />
                By ${node.author}.<br /><br />
                <a href="${node.url}" target="_blank" style="color:lightblue;">Read it here!</a></div>
              `;

              if (node.NSFW) {
                popup.innerHTML = `NOTE: This story is flagged <strong>NSFW</strong>!<br /><br />${popup.innerHTML}`;
              }

              popup.style.left = pointer.x + 10 + "px";
              popup.style.top = pointer.y + 10 + "px";
              popup.style.display = "block";
            }
          } else {
            popup.style.display = "none";
          }
        });
      })
      .catch(error => console.error('Error loading data:', error));
  </script>
</body>

</html>
